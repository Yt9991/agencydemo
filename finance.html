<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reports & Submissions</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: #f9fafb;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .page-header {
      margin: 30px 0 20px;
      text-align: center;
      font-weight: 700;
      color: #0d6efd;
    }
    .filter-container {
      max-width: 400px;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>

<div class="container my-4">
  <h2 class="page-header">Reports & Submissions</h2>

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="reportTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="monthly-tab" data-bs-toggle="tab" data-bs-target="#monthly" type="button" role="tab" aria-controls="monthly" aria-selected="true">Monthly CEA</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="quarterly-tab" data-bs-toggle="tab" data-bs-target="#quarterly" type="button" role="tab" aria-controls="quarterly" aria-selected="false">Quarterly GST</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="annual-tab" data-bs-toggle="tab" data-bs-target="#annual" type="button" role="tab" aria-controls="annual" aria-selected="false">Annual IR8A</button>
    </li>
  </ul>

  <div class="tab-content mt-3" id="reportTabsContent">

    <!-- Monthly CEA Tab -->
    <div class="tab-pane fade show active" id="monthly" role="tabpanel" aria-labelledby="monthly-tab">
      <div class="d-flex justify-content-between flex-wrap mb-2">
        <input type="text" class="form-control filter-container" id="filterMonthly" placeholder="Filter by Salesperson or Reg. No" onkeyup="filterTable('monthlyTable', this.value)" />
        <div>
          <button class="btn btn-outline-primary me-2" onclick="exportTableToCSV('monthlyTable', 'monthly_cea_report.csv')">Export CSV</button>
          <button class="btn btn-outline-success" onclick="exportTableToExcel('monthlyTable', 'monthly_cea_report')">Export Excel</button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-bordered table-striped" id="monthlyTable">
          <thead class="table-primary">
            <tr>
              <th>Date</th>
              <th>Salesperson</th>
              <th>Registration No.</th>
              <th>Transaction Type</th>
              <th>Amount (SGD)</th>
              <th>Commission (SGD)</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>2025-06-05</td><td>Jane Tan</td><td>REG12345</td><td>Sale</td><td>120000</td><td>12000</td></tr>
            <tr><td>2025-06-10</td><td>John Lim</td><td>REG54321</td><td>Rental</td><td>3000</td><td>300</td></tr>
            <tr><td>2025-06-15</td><td>Sarah Chen</td><td>REG67890</td><td>Sale</td><td>85000</td><td>8500</td></tr>
            <!-- Add more rows as needed -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Quarterly GST Tab -->
    <div class="tab-pane fade" id="quarterly" role="tabpanel" aria-labelledby="quarterly-tab">
      <div class="d-flex justify-content-between flex-wrap mb-2">
        <input type="text" class="form-control filter-container" id="filterQuarterly" placeholder="Filter by Salesperson or Reg. No" onkeyup="filterTable('quarterlyTable', this.value)" />
        <div>
          <button class="btn btn-outline-primary me-2" onclick="exportTableToCSV('quarterlyTable', 'quarterly_gst_report.csv')">Export CSV</button>
          <button class="btn btn-outline-success" onclick="exportTableToExcel('quarterlyTable', 'quarterly_gst_report')">Export Excel</button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-bordered table-striped" id="quarterlyTable">
          <thead class="table-primary">
            <tr>
              <th>Quarter</th>
              <th>Salesperson</th>
              <th>Registration No.</th>
              <th>Total Commission (SGD)</th>
              <th>GST Amount (SGD)</th>
              <th>Submission Date</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>Q2 2025</td><td>Jane Tan</td><td>REG12345</td><td>36000</td><td>2520</td><td>2025-07-15</td></tr>
            <tr><td>Q2 2025</td><td>John Lim</td><td>REG54321</td><td>9000</td><td>630</td><td>2025-07-15</td></tr>
            <tr><td>Q2 2025</td><td>Sarah Chen</td><td>REG67890</td><td>25500</td><td>1785</td><td>2025-07-15</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Annual IR8A Tab -->
    <div class="tab-pane fade" id="annual" role="tabpanel" aria-labelledby="annual-tab">
      <div class="d-flex justify-content-between flex-wrap mb-2">
        <input type="text" class="form-control filter-container" id="filterAnnual" placeholder="Filter by Salesperson or Reg. No" onkeyup="filterTable('annualTable', this.value)" />
        <div>
          <button class="btn btn-outline-primary me-2" onclick="exportTableToCSV('annualTable', 'annual_ir8a_report.csv')">Export CSV</button>
          <button class="btn btn-outline-success" onclick="exportTableToExcel('annualTable', 'annual_ir8a_report')">Export Excel</button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-bordered table-striped" id="annualTable">
          <thead class="table-primary">
            <tr>
              <th>Year</th>
              <th>Salesperson</th>
              <th>Registration No.</th>
              <th>Total Commission (SGD)</th>
              <th>Declared to IRAS Date</th>
            </tr>
          </thead>
          <tbody>
            <tr><td>2024</td><td>Jane Tan</td><td>REG12345</td><td>144000</td><td>2025-03-31</td></tr>
            <tr><td>2024</td><td>John Lim</td><td>REG54321</td><td>36000</td><td>2025-03-31</td></tr>
            <tr><td>2024</td><td>Sarah Chen</td><td>REG67890</td><td>102000</td><td>2025-03-31</td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Filter function for tables
  function filterTable(tableId, filterValue) {
    const filter = filterValue.toUpperCase();
    const table = document.getElementById(tableId);
    const trs = table.tBodies[0].getElementsByTagName('tr');

    for (let i = 0; i < trs.length; i++) {
      const tds = trs[i].getElementsByTagName('td');
      let showRow = false;
      for (let j = 0; j < tds.length; j++) {
        if (tds[j].textContent.toUpperCase().indexOf(filter) > -1) {
          showRow = true;
          break;
        }
      }
      trs[i].style.display = showRow ? '' : 'none';
    }
  }

  // Export table to CSV
  function exportTableToCSV(tableId, filename) {
    const table = document.getElementById(tableId);
    let csv = [];
    const rows = table.querySelectorAll('tr');

    for (let i = 0; i < rows.length; i++) {
      let row = [], cols = rows[i].querySelectorAll('th,td');
      for (let j = 0; j < cols.length; j++) {
        let data = cols[j].innerText.replace(/(\r\n|\n|\r)/gm, " ").replace(/,/g, ""); // Remove line breaks & commas
        row.push('"' + data + '"');
      }
      csv.push(row.join(","));
    }

    // Create download link and click it
    let csvFile = new Blob([csv.join("\n")], {type: "text/csv"});
    let downloadLink = document.createElement("a");
    downloadLink.download = filename;
    downloadLink.href = window.URL.createObjectURL(csvFile);
    downloadLink.style.display = "none";
    document.body.appendChild(downloadLink);
    downloadLink.click();
  }

  // Export table to Excel (simple XLS)
  function exportTableToExcel(tableId, filename = '') {
    const table = document.getElementById(tableId);
    const tableHTML = table.outerHTML.replace(/ /g, '%20');
    const dataType = 'application/vnd.ms-excel';
    filename = filename ? filename + '.xls' : 'excel_data.xls';

    let downloadLink = document.createElement("a");
    document.body.appendChild(downloadLink);

    if (navigator.msSaveOrOpenBlob) {
      let blob = new Blob(['\ufeff', tableHTML], { type: dataType });
      navigator.msSaveOrOpenBlob(blob, filename);
    } else {
      downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
      downloadLink.download = filename;
      downloadLink.click();
    }
    document.body.removeChild(downloadLink);
  }
</script>

</body>
</html>
